
def encrypt(message, key, result = ""):
    for index, symbol in enumerate(message):
        pos = len(message) - index
        result += dictN[(dictC[symbol]+(pos*key)+key)%length+1]
        key = sumAll(message[:len(message)-pos+1])%(n-m)
    return result

def decrypt(message, key, result = ""):
    for index, symbol in enumerate(message):
        pos = len(message) - index
        result += dictN[(dictC[symbol]-(pos*key)-key-2)%length+1]
        key = sumAll(result)%(n-m)
    return result

def sumAll(message, summ = 0):
    for symbol in message: summ += dictC[symbol]
    return summ

def toString(listS, final = ""):
    for symbol in listS: final += symbol
    return final

def encryptDecrypt(mode, message, key):
    if mode == 'E':
        enc_message = list(encrypt(message, key))
        enc_message.reverse()
        return encrypt(toString(enc_message), key)
    else:
        dec_message = list(decrypt(message, key))
        dec_message.reverse()
        return decrypt(toString(dec_message), key)



m = 32; n = 127; length = n - m
dictN = {x-m+1 : chr(x) for x in range(m,n)}
dictC = {chr(x) : x-m+1 for x in range(m,n)}

# cryptMode = input("[E]ncrypt|[D]ecrypt: ").upper()
# if cryptMode not in ['E','D']:
#     print("Error: mode is not found")
#     raise SystemExit
#
# startMessage = 'Anton'
# mainKey = settings.key
# for symbol in startMessage:
#     if symbol not in [chr(x) for x in range(m,n)]:
#         startMessage = startMessage.replace(symbol, '')
# print("Final message:", encryptDecrypt(cryptMode, startMessage, mainKey))


key = 856432045866132525974783640414501151812048004091672445999759857301976935885029056263049226873344721476731649949447991101087209158929836710002599330377193274482816938519117075340705682251453043072950589441138881466431642312035872865546143576842550725021650052333612210252856913492082760860082695967115986374004412623810708820870870199350241792004905146602847869309579068908135974886824875660754776961111924974930988798330797584419389728850403520560760968240198041170307481640777110176547638630896083886855381704439206748766923139336755072505521232805296948667597878675517478015381887411541112499965025504623018346453978781450700396410653901624262614771432832289880348171628840067538831005570752063808893194538295133206485875611816412890283303048456228468073657341129167830388274030134660777099903643384770553107643280003465190488063344106622173485393910311501875265338681838566476668734706439928570500160189605575007864764134643687261253408668790979399943941723549365561962818457630706361355020014496185873403039307691233446667442514685945181566007323354072994261302170921550908966090666268555975396408980806581210081880969511261499493251022210194361072213296440209887102901633437968910529089664829284695381365944145821768885750844681839762774353052639416362153101399763395103907249191448386607185388984940850903010261622408320442999912252128160876523123494245682704486215875254863202527684490284422552036739995394610119197522421174915340551356237928199570900252402203462742652160856056727564132578691398762672205084893024773294461279954692861342377104851948093066433835074687048687180100108880827441467619011822962236893625132747774521309637364822751353505243374923060279579373724018856602546466905872033599202368639680582157025462051935493537263477891813987276807142830911214524228409316307604127745710554402774293137492786564004455306059611687013570914214846871298229939025663550778102840673256654756414434839172791489792393274032289905614160160775985016994711351144609281483070016143101181156202544342751817910547929200440313297334259404889100630268093238114092079828481290755116600435317957385787369567193796642537467837961817555469102745870815810881857763631986366116803174760535640139970899071890946691281397236679905325093368690475789783210952186414518806704479236614227766300041517200090273266798973803469703796215720877841222069304401311778192442531139448275221887696802089056113658182315339845372742540633680926512643322684026766270806361540082636492050600441285596708577007652671073879154415869332079880171141900567392337805275817714220597591491974709840298453384066203018706438236011760124179309888531920829743564864328854290281173390901790458294700987282584490938214175829039654066902866003812285603902449781752312354977070172015324451627698825000282744571945183540700737883492197418722188854772510245368312255222953182763164567348777757183159967645218836575372347328665833612827874106973229904974704862265605540838543111648057872266308904515052017611197213155134009654163985338508327228271145959718178176054318765148522338287720224212409538608459540635721606462708997987114902197112627428604479769282990475130983120615943368856025850817260585388241103943054304351199733730535978956815406761653744194929693393421427040163558520845209163046842523326160820901910905476281431891281251919613965157871259821071726010150510903856839176040449660526123192958588239244468370610189174843083768311670732481818373752291488729767929949698027492218750460997040102268874298064943173002158665862310598829041542142179273023359138306833607119572549412597738794269522874202802340675987807384276623743599873243950044179352590834497733333697314378725814893771507324184049936745842495183419423193262727595702480243766929935548018836740562883970683344322007758190270524121502643665155087089487625131702337486419668020145437283368020348610470072940186766460916632393595932054176434364278612504503317277623583784940765777085829684992271613982009970180011343216181906849895373149581756761695775754774467494940750567201493454890372639243377070205870052648164372753335440901516517878369018420607662387650571569128486240264816754687429562249938421659616526402319516300371527801348854124503101270652310875967824175392541387086119005590334463475962534290396272620523321493389159878536200956013161094512069825663354482475482117419802605033069551626462890714674380633872555158008976516849273670225374800404005760733283668320515380386370028868813523662114050761774953025202304035128075155800627609388295063371056167726164250727704035415019832190961412891701733839935287858087773636288252702551435530453006307809662942090293753860392603597396584507787455588423322648730435505017138751801116173862036170249571557287327795905724323363632145032371777896363695620190964858943170744739458426761224540888517027124748585570312104055218333274721676569893032464422123685649477179298357433005101488724763919655649718341374228437526628389050589265206898166091890524700962025827622283710346216076541209625190055214112551774316577192826674641884913838636757440659046544568330149323993175659187145342613065761217435426132371955413874081959388265100997166792678559554746020852720402435663631177856167486338902126395873347903901814051667988930727065328934772930591705428922741562133184740120714279171587326444264030019796854123272493120009089158881323026765125625659668790081868073399127068266473130106876448143977375757932792085382501659381558801995887680186039642128231390235352376904407601725776981181360102454688760619424593707295254790884042154304626493721126608961879738318181964382562373635008771230800531420973666813023504775407622509942264711165387829268436442030157374388327826256541214924178161085827940536718350694859195226323951920312578098804737615701161290585645293207410455222387411641009779061986683141293731922472029933699575782834036490754003532793501144130090946437331010058997423396988221436451208487452032988521384493135162295581913830390511382240823168005475893942781041599121030266753278616380658724306270448045676367144937724047035365748983442219387032130473730716113554523438535252201197787817418504931681814300528007681077434302293941442813844506126915387088225738952051003586569892271078749857727435557254193444060363926624199508804618491080682764403059780556385781724747993059099799033404441518883266920147763072404023790267005002081272768588540165779377039701674534448842966172535621757822362860235773101732399398462616574900767307107207152156308443142047355378816184469743432828238196343787413451704307433968413121269858181117845237645549757111677245135304038320226469211751769931640049942497650751625890331769142346605490300894412280860624483659834975877839921215400223893010432026759411770338671686577355182265887728884287364129658422750146344293992903717951778248234759199185813015741024437071462172865774407057888160998803970900002804168780809408504078141986082775283562582626965305762755379922484337924197837633739465291179401628315116892219994489046116574693173701380165490221024306461325336351128331536557669072261612692234133994714035374019678730798981483063971214002131067828914563381439645947367733523324872370335529613943336423894601205756784945638980612487708365461850233269455284804346286585048257388829312644371801500814517634039517890190577949099580737488178186862414174708589834964277230618873684260385485837135407952991415676018961099944035635596141729763064851215003969395159469035875204311874450813862708070215875065657868697481339166419586430031786316406103813106114589741477851963589405923398408213853816081427678249491327846892789227724251886384969926633345413291945847983611403961883527481172473007203334705213302361175396128018002507206614198691471983767412865533884491631755628377255361007069362031542701799375439408655589900376488284544929481769071133387050369051385011381906851182076332721604419945902923740257238147584028364191628057134124647656871959949865425720381041528277417889216650331993632979275679123404574654601157031662741717541946558054226538446243616222087463558894418383964820972781280514399910435442029053720403223618227546092643782439668054750939079816077854856215916058680804047350406380629018686298428177610873260509289961912134704707603639713850765679863508405775439674564820406796910601354583954630398907916429497764521855290983701728737497031156978877570702124063589466288983705826485218659750636302453421835820535925026532902913431892344265617817919444627594853168123040025274612045713231710959102038476027787668358258783191200640043959484692993853175484042526681138149947335697053989848485468365830960634316335310685169422088045264894968331627827061021988387291448614787269696457996146904590552969101360808442594819340874936791475273052900946249572168410881867985130892547349189760405484295013829321089187408435052493910398094483511691465928731902539059029807287593669482908975931122008822774880644531888522774882000834475241059199737428768565965310986884787145833136634149378365840832483393006244370756020399839565169221739410835367345465985860325203586023496722998336976975579407448969821252156914482454140392746604986032576380942244731978753609684996106458255484483279550698464715943702982118572844465659408477228768359518454418280824884603958781288622457088202436154452661441944841839179714315167070770104305748063879670013551457666149242877896548905995196741479154186131341125589221214948321882470240883091301436074545116049105658554733140844331348713167357143353134265806602620671834726338863045080858789251208424398502393182382804325899519549465620410190728569655432349775905159440125527859070838474600857144813751322777467434264870880597458927844287323213212711411537243785687144266617608085895688616892929997018917424753555390644624087752021161160484149267332119086581482469628530473618081322514799293980055775599328152727762657537892320653740819799176452622858926934621701198035631712647091884945286950448349797131793056129394398858126676237518751555163982562628358312215993497140226861233619880035314605708498853483542205852818451713727568616382620070498413168711251242968599125957475819595508572701935812886106090212192082798825607000842234919723942956326039993718665126160647413180851820157568745524401488973711308979035850079463366678886473198241296630163063282672405463431083597646170813391736619638569854211619490127515903637537079108136483801516672428047712536992564998731468189745983279422029670278205066673868148438642979807758394558692530537690908502867973604512722155792018796016520569025091105311903750083382497218319724872075189398202923651117127432556281899741662635933746282604816886113883967054891109023939559271713564596930245942114979938419697654863374766259420985583962717593474692792044697880346528734327663155689916717847614155051993669599338831040068015304279621853418246413411178598047474740291137423852969064542814379743325614842125399343446219125473997963721932506759804088613768442786251559598985247858197734807825349309869241332810535560282135956210511331411781289602062301052815253279908475702690891074894698247139240454370195890288127915761794837236779947951082732913513762665234361473120736862073836082475184730686690045807047023538593627193072566991468294718847265418274506212188453484450444207720846474400956460028603724206999486019484978743667683436848606874256347656595800888085107222841087925915273014713513855026521541771293484927858272212328197312108456806797399051604391257487832718411053411415607559969418105240845031043506451125657716777050222431596119839509117066193141376299548213953341422878848079694217726659489826185298507364143793619848223937699099682033236771361668882146435028379311042811026889196888736529893155087127342075770895109173794170804525374050880694635422356811207747323079957257090156816480366598343765455337067043051335898251799246541248782141190637986804470846281942408038582880850942716132252888536491482657102012865239821340216148311175849417915393049014537709529506185684241940212182950898220527655322421493795804460165789665695229637474707893100074313338823354976940112699707820078325080965850493543407044041116971711701301756340003272976356569376993475995244227899675318230204375002424497270190567262082919034595161670316112406402494040595661222952725964766715996559578447825523409720273406710997615985638948241053940463815576539411942548383256074961104456220747403822667109660660319863454962214896703860644031607399611418685668491205895760647139140917324862749046888027820524348365640899044531483648082367203016632803421365235451353722318910410449800618769194749466211076773070625387150301
mes = encrypt('serpent26rus@gmail.com',key)
print(f'{mes} : {decrypt(mes,key)}')